<!-- frontend/login.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>DailyFit â€” Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <style>
    :root {--primary-color:#ff6b6b;--dark-bg:#121212;--text-light:#f9f9f9}
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body,html{height:100%;font-family:'Poppins',sans-serif}
    a{color:inherit;text-decoration:none} a:visited{color:inherit}

    header{
      position:fixed;top:0;width:100%;height:70px;
      background:var(--dark-bg);color:var(--text-light);
      display:flex;align-items:center;justify-content:space-between;
      padding:0 2rem;z-index:1000;
    }
    .logo{display:flex;align-items:center}
    .logo img{height:40px;margin-right:0.5rem}
    .logo span{font-size:1.5rem;font-weight:600}
    nav a{margin-left:1.5rem}

    .hero{
      height:100vh;padding-top:70px;
      background:url('/static/images/gym1.jpg')center/cover;
      display:flex;align-items:center;justify-content:center;
      position:relative;
    }
    .hero::before{
      content:'';position:absolute;inset:0;
      background:rgba(0,0,0,.5);
    }
    .hero-content{
      position:relative;z-index:1;color:var(--text-light);
      background:rgba(255,255,255,.1);backdrop-filter:blur(8px);
      padding:2rem;border-radius:8px;width:90%;max-width:400px;
    }
    .hero-content h2{text-align:center;margin-bottom:1.5rem}
    .hero-content input,.hero-content button{
      width:100%;padding:0.75rem;margin-bottom:1rem;
      border:none;border-radius:4px;
    }
    .hero-content button{
      background:var(--primary-color);color:#fff;
      cursor:pointer;font-weight:600;
    }
    #login-response{margin-top:1rem;color:#ff6b6b;text-align:center}
  </style>
</head>
<body>
  <header>
    <a href="/" class="logo">
      <img src="/static/images/logo.png" alt="DailyFit Logo">
      <span>DailyFit</span>
    </a>
    <nav>
      <a href="/register">Register</a>
      <a href="/about">About</a>
    </nav>
  </header>

  <section class="hero">
    <div class="hero-content">
      <h2>Login to DailyFit</h2>
      <input type="email" id="email" placeholder="Email" required>
      <input type="password" id="password" placeholder="Password" required>
      {% if captcha_enabled %}
      <div class="g-recaptcha" data-sitekey="{{ site_key }}"></div>
      {% endif %}
      <button id="loginBtn">Login</button>
      <p id="login-response"></p>
    </div>
  </section>

  <script>
    const captchaEnabled = {{ 'true' if captcha_enabled else 'false' }};
    document.getElementById('loginBtn').onclick = async () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const token = captchaEnabled ? grecaptcha.getResponse() : '';
      if (captchaEnabled && !token) {
        document.getElementById('login-response').innerText = 'Please complete the CAPTCHA.';
        return;
      }
      const payload = { email, password };
      if (captchaEnabled) payload['g-recaptcha-response'] = token;
      const res = await fetch('/login', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        credentials:'include',
        body:JSON.stringify(payload)
      });
      const data = await res.json();
      if (res.ok) {
        localStorage.setItem('token', data.token);
        localStorage.setItem('name', data.name);
        window.location.href = '/dashboard';
      } else {
        document.getElementById('login-response').innerText = data.detail||'Login failed.';
        if (captchaEnabled) grecaptcha.reset();
      }
    };
  </script>
</body>
</html>
